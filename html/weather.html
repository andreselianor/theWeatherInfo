<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>Weather Forecast | Weather Ecosystems</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel='icon' type='icon' href='../media/icons/icon.svg'>
  <link rel='stylesheet' type='text/css' media='screen' href='../css/weather.css'>
  <link rel='stylesheet' type='text/css' media='screen' href='../css/ecosistem.css'>
  <script src='../js/weather.js' defer></script>
  <script src='../js/header.js' defer></script>
  <script src='../js/footer.js' defer></script>
  <script src='../js/movement.js' defer></script>
</head>

<body>
  <my-header></my-header>

  <main>
    <div class="ecosistems">
      <button class="arrow-btn">&lt;</button>
      <button class="circle-btn" style="--c1:#ff6b6b; --c2:#feca57; --c3:#1dd1a1; --c4:#5f27cd;"
        title="Turist in Alicante" onclick="createTuristCards()"></button>
      <button class="circle-btn" style="--c1:#ff9f43; --c2:#ee5253; --c3:#54a0ff; --c4:#00d2d3;"
        title="European Capitals" onclick="createCapitalsCards()"></button>
      <button class="circle-btn" style="--c1:#1dd1a1; --c2:#10ac84; --c3:#f368e0; --c4:#5f27cd;"
        title="la mar"></button>
      <button class="circle-btn" style="--c1:#ff6b6b; --c2:#48dbfb; --c3:#ff9f43; --c4:#341f97;"
        title="nevadas"></button>
      <button class="circle-btn" style="--c1:#00d2d3; --c2:#feca57; --c3:#ff6b6b; --c4:#5f27cd;"
        title="15 dias"></button>
      <button class="circle-btn" style="--c1:#f368e0; --c2:#ff9f43; --c3:#1dd1a1; --c4:#54a0ff;"
        title="pescadores / marisqueras"></button>
      <button class="circle-btn" style="--c1:#5f27cd; --c2:#48dbfb; --c3:#ff6b6b; --c4:#feca57;"
        title="alertas"></button>
      <button class="circle-btn" style="--c1:#10ac84; --c2:#341f97; --c3:#ff9f43; --c4:#f368e0;"
        title="mareas"></button>
      <button class="circle-btn" style="--c1:#ff9f43; --c2:#1dd1a1; --c3:#54a0ff; --c4:#ff6b6b;"
        title="deporte"></button>
      <button class="circle-btn" style="--c1:#48dbfb; --c2:#5f27cd; --c3:#feca57; --c4:#ff9f43;"
        title="salvamento"></button>
      <button class="arrow-btn">&gt;</button>
    </div>

    <div id="cards">
    </div>
  </main>

  <my-footer></my-footer>

  <script>
    const url_temperatures = "https://api.open-meteo.com/v1/forecast?latitude=38.3452&longitude=-0.4815&hourly=temperature_2m,relative_humidity_2m,dew_point_2m,apparent_temperature,precipitation_probability,precipitation,rain,showers,snowfall,snow_depth&forecast_days=1";
    const url_capitals = "https://api.open-meteo.com/v1/forecast?latitude=40.4165,51.5085,41.8919,48.8534,52.5244,55.6759,38.7167,46.9481&longitude=-3.7026,-0.1257,12.5113,2.3488,13.4105,12.5655,-9.1333,7.4474&hourly=temperature_2m,precipitation_probability,relative_humidity_2m&forecast_days=1";
    let jsonData;
    let cardRoot = document.getElementById("cards");
    let temperatureInfo, humidityInfo, precipitationInfo, capitalsInfo, capitalsInfoPrecipitation, capitalsInfoHumidity

    async function getTemperatureDataFromURL() {
      await fetch(url_temperatures)
        .then(response => response.json())
        .then(data => {
          setTemperatureInfo(data)
          setHumidityInfo(data)
          setPrecipitationInfo(data)
          createWelcomeTitle();
          view();
        })
    }

    async function getCapitalsDataFromURL() {
      await fetch(url_capitals)
        .then(response => response.json())
        .then(data => {
          setCapitalsData(data)
          view();
        })
    }

    function setTemperatureInfo(data) {
      temperatureInfo = {
        temperature_9: data.hourly.temperature_2m[10],
        temperature_12: data.hourly.temperature_2m[13],
        temperature_15: data.hourly.temperature_2m[16],
        temperature_17: data.hourly.temperature_2m[18],
        temperature_20: data.hourly.temperature_2m[21],
        temperature_22: data.hourly.temperature_2m[23]
      }
    }

    function setHumidityInfo(data) {
      humidityInfo = {
        humidity_9: data.hourly.relative_humidity_2m[10],
        humidity_12: data.hourly.relative_humidity_2m[13],
        humidity_15: data.hourly.relative_humidity_2m[16],
        humidity_17: data.hourly.relative_humidity_2m[18],
        humidity_20: data.hourly.relative_humidity_2m[21],
        humidity_22: data.hourly.relative_humidity_2m[23]
      }
    }

    function setPrecipitationInfo(data) {
      precipitationInfo = {
        precipitation_9: data.hourly.precipitation_probability[10],
        precipitation_12: data.hourly.precipitation_probability[13],
        precipitation_15: data.hourly.precipitation_probability[16],
        precipitation_17: data.hourly.precipitation_probability[18],
        precipitation_20: data.hourly.precipitation_probability[21],
        precipitation_22: data.hourly.precipitation_probability[23]
      }
    }

    function setCapitalsData(data) {
      capitalsInfo = {
        capitalMadrid: data[0].hourly.temperature_2m[13],
        capitalLondon: data[1].hourly.temperature_2m[13],
        capitalRome: data[2].hourly.temperature_2m[13],
        capitalParis: data[3].hourly.temperature_2m[13],
        capitalBerlin: data[4].hourly.temperature_2m[13],
        capitalCopenhagen: data[5].hourly.temperature_2m[13],
        capitalLisboa: data[6].hourly.temperature_2m[13],
        capitalSuiza: data[7].hourly.temperature_2m[13]
      }
      capitalsInfoPrecipitation = {
        capitalMadrid: data[0].hourly.precipitation_probability[13],
        capitalLondon: data[1].hourly.precipitation_probability[13],
        capitalRome: data[2].hourly.precipitation_probability[13],
        capitalParis: data[3].hourly.precipitation_probability[13],
        capitalBerlin: data[4].hourly.precipitation_probability[13],
        capitalCopenhagen: data[5].hourly.precipitation_probability[13],
        capitalLisboa: data[6].hourly.precipitation_probability[13],
        capitalSuiza: data[7].hourly.precipitation_probability[13]
      }
      capitalsInfoHumidity = {
        capitalMadrid: data[0].hourly.relative_humidity_2m[13],
        capitalLondon: data[1].hourly.relative_humidity_2m[13],
        capitalRome: data[2].hourly.relative_humidity_2m[13],
        capitalParis: data[3].hourly.relative_humidity_2m[13],
        capitalBerlin: data[4].hourly.relative_humidity_2m[13],
        capitalCopenhagen: data[5].hourly.relative_humidity_2m[13],
        capitalLisboa: data[6].hourly.relative_humidity_2m[13],
        capitalSuiza: data[7].hourly.relative_humidity_2m[13]
      }
    }

    function view() {
      console.log(temperatureInfo);
      console.log(humidityInfo);
      console.log(precipitationInfo);
    }

    function createCard(cardTitle, cardDescription, jsonData) {
      let element = document.createElement("div");
      let title = document.createElement("h2");
      let value = document.createElement("div");
      let description = document.createElement("div");
      let image = document.createElement("img");

      element.classList.add("card");
      value.classList.add("value");
      description.classList.add("info");
      image.classList.add("gif");

      title.textContent = cardTitle;
      value.textContent = jsonData;
      description.textContent = cardDescription;
      image.src = "../media/gifs/rain.gif"

      element.append(image);
      element.append(description);
      element.append(value);
      element.append(title);

      cardRoot.append(element);
    }

    function createTuristCards() {
      resetCards();
      createCard("Temperature C°", "Temperature at 10AM", temperatureInfo.temperature_9);
      createCard("Temperature C°", "Temperature at 13PM", temperatureInfo.temperature_12);
      createCard("Temperature C°", "Temperature at 16PM", temperatureInfo.temperature_15);
      createCard("Temperature C°", "Temperature at 18PM", temperatureInfo.temperature_17);
      createCard("Temperature C°", "Temperature at 21PM", temperatureInfo.temperature_20);
      createCard("Humidity %", "Humidity at 22PM", humidityInfo.humidity_22);

      let card = document.getElementsByClassName("card")[0];
      let centerX = window.innerWidth / 2;
      let centerY = window.innerHeight / 2;
      let distanceToMouseX, distanceToMouseY;
      document.addEventListener('mousemove', event => {
        distanceToMouseX = (event.clientX - centerX) / 10;
        distanceToMouseY = (event.clientY - centerY) / 10;
        card.style.transform = `perspective(1000px) rotateY(${distanceToMouseX}deg) rotateX(${distanceToMouseY}deg)`
      });
    }

    function createCapitalsCards() {
      resetCards();
      createCard("Temperature C°", "Madrid, Spain", capitalsInfo.capitalMadrid);
      createCard("Rain Probability %", "Madrid, Spain", capitalsInfoPrecipitation.capitalMadrid);
      createCard("Humidity %", "Madrid, Spain", capitalsInfoHumidity.capitalMadrid);
      createCard("Rain Probability %", "London, UK", capitalsInfoPrecipitation.capitalLondon);
      createCard("Humidity %", "London, UK", capitalsInfoHumidity.capitalLondon);
      createCard("Temperature C°", "Rome, Italy", capitalsInfo.capitalRome);
      createCard("Humidity %", "Rome, Italy", capitalsInfoHumidity.capitalRome);
      createCard("Temperature C°", "Paris, France", capitalsInfo.capitalParis);
      createCard("Rain Probability %", "Paris, France", capitalsInfoPrecipitation.capitalParis);
      createCard("Rain Probability %", "Copenhagen, Denmark", capitalsInfoPrecipitation.capitalCopenhagen);
      createCard("Humidity %", "Copenhagen, Denmark", capitalsInfoHumidity.capitalCopenhagen);
      createCard("Temperature C°", "Bern, Schweiz", capitalsInfo.capitalSuiza);
      createCard("Rain Probability %", "Bern, Schweiz", capitalsInfoPrecipitation.capitalSuiza);
      createCard("Temperature C°", "Lisbon, Portuguese", capitalsInfo.capitalLisboa);
      createCard("Rain Probability %", "Lisbon, Portuguese", capitalsInfoPrecipitation.capitalLisboa);
      createCard("Humidity %", "Lisbon, Portuguese", capitalsInfoHumidity.capitalLisboa);
    }
    function createWelcomeTitle() {
      let welcome = document.createElement("h3");
      welcome.textContent = "Select an Ecosystem";
      cardRoot.append(welcome);
    }
    function resetCards() {
      cardRoot.textContent = "";
    }

    getTemperatureDataFromURL();
    getCapitalsDataFromURL();

  </script>
</body>

</html>